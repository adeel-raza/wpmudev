(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function a(e,a,l){return(a=function(e){var a=function(e){if("object"!=t(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,"string");if("object"!=t(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(a)?a:a+""}(a))in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l,e}e.n=t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},e.d=(t,a)=>{for(var l in a)e.o(a,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:a[l]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const l=React;var n=e.n(l);const r=wp.i18n,i=wp.apiFetch;var s=e.n(i);function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,l)}return a}function c(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?o(Object(l),!0).forEach(function(t){a(e,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):o(Object(l)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))})}return e}const d=()=>{const[e,t]=(0,l.useState)({clientId:"",clientSecret:""}),[a,i]=(0,l.useState)(!1),[o,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(""),[p,v]=(0,l.useState)(null),[g,f]=(0,l.useState)([]),[w,_]=(0,l.useState)(null),[E,h]=(0,l.useState)(""),[y,b]=(0,l.useState)(0),[N,S]=(0,l.useState)(!1);(0,l.useEffect)(()=>{O(),D(),m(window.location.origin+"/wp-admin/admin.php?page=wpmudev_plugintest_drive")},[]),(0,l.useEffect)(()=>{a&&C()},[a]);const O=async()=>{try{const e=await s()({path:"/wpmudev/v1/drive/credentials",method:"GET"});e.success&&t({clientId:e.data.clientId||"",clientSecret:e.data.clientSecret||""})}catch(e){console.error("Error loading credentials:",e)}},D=async()=>{try{const e=await s()({path:"/wpmudev/v1/drive/auth-status",method:"GET"});e.success&&i(e.data.authenticated)}catch(e){console.error("Error checking auth status:",e)}},C=async()=>{if(a)try{const e=await s()({path:"/wpmudev/v1/drive/files",method:"GET"});e.success?f(e.data.files||[]):P("error",e.data.message||(0,r.__)("Failed to load files","wpmudev-plugin-test"))}catch(e){console.error("Error loading files:",e),P("error",(0,r.__)("Error loading files:","wpmudev-plugin-test")+" "+e.message)}},P=(e,t)=>{v({type:e,message:t}),setTimeout(()=>v(null),5e3)};return n().createElement("div",{className:"google-drive-admin"},p&&n().createElement("div",{className:"notice notice-".concat(p.type," is-dismissible")},n().createElement("p",null,p.message),n().createElement("button",{type:"button",className:"notice-dismiss",onClick:()=>v(null)},n().createElement("span",{className:"screen-reader-text"},"Dismiss this notice."))),n().createElement("div",{className:"google-drive-section"},n().createElement("div",{className:"google-drive-section-header"},n().createElement("h2",null,(0,r.__)("Google Drive Credentials","wpmudev-plugin-test"))),n().createElement("div",{className:"google-drive-section-body"},n().createElement("form",{onSubmit:async t=>{t.preventDefault(),d(!0);try{const t=await s()({path:"/wpmudev/v1/drive/save-credentials",method:"POST",data:{client_id:e.clientId,client_secret:e.clientSecret}});t.success?(P("success",(0,r.__)("Credentials saved successfully!","wpmudev-plugin-test")),D()):P("error",t.data.message||(0,r.__)("Failed to save credentials","wpmudev-plugin-test"))}catch(e){P("error",(0,r.__)("Error saving credentials:","wpmudev-plugin-test")+" "+e.message)}finally{d(!1)}},className:"credentials-form"},n().createElement("div",{className:"credential-field"},n().createElement("label",{htmlFor:"client-id"},(0,r.__)("Client ID","wpmudev-plugin-test")),n().createElement("input",{type:"text",id:"client-id",value:e.clientId,onChange:a=>t(c(c({},e),{},{clientId:a.target.value})),placeholder:(0,r.__)("Enter Client ID","wpmudev-plugin-test"),required:!0})),n().createElement("div",{className:"credential-field"},n().createElement("label",{htmlFor:"client-secret"},(0,r.__)("Client Secret","wpmudev-plugin-test")),n().createElement("input",{type:"password",id:"client-secret",value:e.clientSecret,onChange:a=>t(c(c({},e),{},{clientSecret:a.target.value})),placeholder:(0,r.__)("Enter Client Secret","wpmudev-plugin-test"),required:!0})),n().createElement("div",{className:"credential-field"},n().createElement("button",{type:"submit",className:"button-primary",disabled:o},o?(0,r.__)("Saving...","wpmudev-plugin-test"):(0,r.__)("Save Credentials","wpmudev-plugin-test")))),n().createElement("div",{className:"redirect-uri-info"},n().createElement("h4",null,(0,r.__)("Redirect URI Configuration","wpmudev-plugin-test")),n().createElement("p",null,(0,r.__)("Add this exact URL to your Google Cloud Console OAuth 2.0 Client configuration:","wpmudev-plugin-test")),n().createElement("div",{className:"redirect-uri-code"},u)),n().createElement("div",{className:"oauth-scopes"},n().createElement("h4",null,(0,r.__)("Required OAuth Scopes","wpmudev-plugin-test")),n().createElement("p",null,(0,r.__)("This plugin requires the following Google Drive API permissions:","wpmudev-plugin-test")),n().createElement("ul",{className:"scope-list"},n().createElement("li",null,n().createElement("strong",null,"https://www.googleapis.com/auth/drive.file")," - ",(0,r.__)("Drive File Access","wpmudev-plugin-test")),n().createElement("li",null,n().createElement("strong",null,"https://www.googleapis.com/auth/drive.readonly")," - ",(0,r.__)("Drive Read-Only Access","wpmudev-plugin-test")))))),n().createElement("div",{className:"google-drive-section"},n().createElement("div",{className:"google-drive-section-header"},n().createElement("h2",null,(0,r.__)("Authentication Status","wpmudev-plugin-test"))),n().createElement("div",{className:"google-drive-section-body"},n().createElement("div",{className:"auth-status ".concat(a?"authenticated":"not-authenticated")},n().createElement("span",{className:"auth-status-icon"},a?"✅":"❌"),a?(0,r.__)("Connected to Google Drive","wpmudev-plugin-test"):(0,r.__)("Not connected to Google Drive","wpmudev-plugin-test")),e.clientId&&e.clientSecret&&n().createElement("button",{onClick:async()=>{d(!0);try{const e=await s()({path:"/wpmudev/v1/drive/authenticate",method:"POST"});if(e.success&&e.data.auth_url){const t=window.open(e.data.auth_url,"google-auth","width=500,height=600,scrollbars=yes,resizable=yes"),a=setInterval(()=>{t.closed&&(clearInterval(a),D(),C())},1e3)}else P("error",e.data.message||(0,r.__)("Failed to initiate authentication","wpmudev-plugin-test"))}catch(e){P("error",(0,r.__)("Error authenticating:","wpmudev-plugin-test")+" "+e.message)}finally{d(!1)}},className:"button-primary",disabled:o},o?(0,r.__)("Authenticating...","wpmudev-plugin-test"):(0,r.__)("Authenticate with Google Drive","wpmudev-plugin-test")))),a&&n().createElement(n().Fragment,null,n().createElement("div",{className:"google-drive-section"},n().createElement("div",{className:"google-drive-section-header"},n().createElement("h2",null,(0,r.__)("Upload File to Drive","wpmudev-plugin-test"))),n().createElement("div",{className:"google-drive-section-body"},n().createElement("div",{className:"file-upload-area",onClick:()=>document.getElementById("file-input").click()},n().createElement("div",{className:"file-upload-icon"},"📁"),n().createElement("div",{className:"file-upload-text"},w?w.name:(0,r.__)("Click to select a file","wpmudev-plugin-test")),n().createElement("div",{className:"file-upload-hint"},(0,r.__)("Maximum file size: 10MB","wpmudev-plugin-test"))),n().createElement("input",{type:"file",id:"file-input",onChange:async e=>{const t=e.target.files[0];if(!t)return;_(t),S(!0),b(0);const a=new FormData;a.append("file",t);try{var l;const e=new XMLHttpRequest;e.upload.addEventListener("progress",e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);b(t)}}),e.addEventListener("load",()=>{if(e.status>=200&&e.status<300){const t=JSON.parse(e.responseText);t.success?(P("success",(0,r.__)("File uploaded successfully!","wpmudev-plugin-test")),C(),_(null)):P("error",t.data.message||(0,r.__)("Failed to upload file","wpmudev-plugin-test"))}else P("error",(0,r.__)("Upload failed","wpmudev-plugin-test"));S(!1),b(0)}),e.addEventListener("error",()=>{P("error",(0,r.__)("Upload failed","wpmudev-plugin-test")),S(!1),b(0)}),e.open("POST","/wp-json/wpmudev/v1/drive/upload"),e.setRequestHeader("X-WP-Nonce",(null===(l=window.wpmudevDriveTest)||void 0===l?void 0:l.nonce)||""),e.send(a)}catch(e){P("error",(0,r.__)("Error uploading file:","wpmudev-plugin-test")+" "+e.message),S(!1),b(0)}},style:{display:"none"},disabled:N}),N&&n().createElement("div",{className:"upload-progress-container"},n().createElement("div",{className:"upload-progress-bar"},n().createElement("div",{className:"upload-progress-fill",style:{width:"".concat(y,"%")}})),n().createElement("div",{className:"upload-progress-text"},(0,r.__)("Uploading...","wpmudev-plugin-test")," ",y,"%")))),n().createElement("div",{className:"google-drive-section"},n().createElement("div",{className:"google-drive-section-header"},n().createElement("h2",null,(0,r.__)("Create New Folder","wpmudev-plugin-test"))),n().createElement("div",{className:"google-drive-section-body"},n().createElement("form",{onSubmit:async e=>{if(e.preventDefault(),E.trim()){d(!0);try{const e=await s()({path:"/wpmudev/v1/drive/create-folder",method:"POST",data:{folder_name:E.trim()}});e.success?(P("success",(0,r.__)("Folder created successfully!","wpmudev-plugin-test")),h(""),C()):P("error",e.data.message||(0,r.__)("Failed to create folder","wpmudev-plugin-test"))}catch(e){P("error",(0,r.__)("Error creating folder:","wpmudev-plugin-test")+" "+e.message)}finally{d(!1)}}},className:"folder-form"},n().createElement("input",{type:"text",value:E,onChange:e=>h(e.target.value),placeholder:(0,r.__)("Enter folder name","wpmudev-plugin-test"),required:!0}),n().createElement("button",{type:"submit",className:"button-primary",disabled:o||!E.trim()},o?(0,r.__)("Creating...","wpmudev-plugin-test"):(0,r.__)("Create Folder","wpmudev-plugin-test"))))),n().createElement("div",{className:"google-drive-section"},n().createElement("div",{className:"google-drive-section-header"},n().createElement("h2",null,(0,r.__)("Your Drive Files","wpmudev-plugin-test"))),n().createElement("div",{className:"google-drive-section-body"},n().createElement("div",{className:"files-list"},0===g.length?n().createElement("div",{className:"no-files"},(0,r.__)("No files found in your Drive. Upload a file or create a folder to get started.","wpmudev-plugin-test")):g.map((e,t)=>{return n().createElement("div",{key:e.id||t,className:"file-item"},n().createElement("div",{className:"file-icon"},(a=e.mimeType).includes("folder")?"📁":a.includes("image")?"🖼️":a.includes("video")?"🎥":a.includes("audio")?"🎵":a.includes("pdf")?"📄":a.includes("document")?"📝":a.includes("spreadsheet")?"📊":a.includes("presentation")?"📽️":"📄"),n().createElement("div",{className:"file-info"},n().createElement("div",{className:"file-name"},e.name),n().createElement("div",{className:"file-meta"},"application/vnd.google-apps.folder"!==e.mimeType&&(e=>{if(!e)return"Unknown size";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]})(e.size)," • ",(e=>{const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()})(e.modifiedTime))),n().createElement("div",{className:"file-actions"},"application/vnd.google-apps.folder"!==e.mimeType?n().createElement(n().Fragment,null,n().createElement("a",{href:e.webViewLink,target:"_blank",rel:"noopener noreferrer",className:"file-action-btn"},(0,r.__)("View in Drive","wpmudev-plugin-test")),n().createElement("a",{href:e.webContentLink,download:!0,className:"file-action-btn"},(0,r.__)("Download","wpmudev-plugin-test"))):n().createElement("a",{href:e.webViewLink,target:"_blank",rel:"noopener noreferrer",className:"file-action-btn"},(0,r.__)("View in Drive","wpmudev-plugin-test"))));var a}))))))};if("undefined"!=typeof window&&window.wpmudevDriveTest){const{dom_element_id:e}=window.wpmudevDriveTest,t=document.getElementById(e);if(t){const{createElement:e,render:a}=window.wp.element;a(e(d),t)}}})();