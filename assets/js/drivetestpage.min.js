(()=>{"use strict";const e=wp.element,t=wp.components;var a;function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,l)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function r(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,t||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}void 0===window.wpmudevDriveTest&&console.error("WPMU DEV Drive Test: Localized data not available");const i=document.getElementById(null===(a=window.wpmudevDriveTest)||void 0===a?void 0:a.dom_element_id);i||console.error("WPMU DEV Drive Test: DOM element not found");const o=()=>{var a,l,r,i;const[o,s]=(0,e.useState)((null===(a=window.wpmudevDriveTest)||void 0===a?void 0:a.authStatus)||!1),[c,d]=(0,e.useState)((null===(l=window.wpmudevDriveTest)||void 0===l?void 0:l.hasCredentials)||!1),[m,u]=(0,e.useState)(!(null!==(r=window.wpmudevDriveTest)&&void 0!==r&&r.hasCredentials)),v=(null===(i=window.wpmudevDriveTest)||void 0===i?void 0:i.i18n)||{},[p,w]=(0,e.useState)(!1),[E,g]=(0,e.useState)([]),[f,h]=(0,e.useState)(null),[R,b]=(0,e.useState)(""),[y,N]=(0,e.useState)({message:"",type:""}),[D,T]=(0,e.useState)({clientId:"",clientSecret:""});(0,e.useEffect)(()=>{o&&C()},[o]);const P=function(e){N({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>N({message:"",type:""}),5e3)},C=async()=>{w(!0);try{const e=await fetch("/wp-json/wpmudev/v1/drive/files",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wpmudevDriveTest.nonce}}),t=await e.json();t.success&&t.files?g(t.files):P(t.message||"Failed to load files","error")}catch(e){P("Error loading files: "+e.message,"error")}finally{w(!1)}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"sui-header"},React.createElement("h1",{className:"sui-header-title"},v.pageTitle||"Google Drive Test"),React.createElement("p",{className:"sui-description"},v.pageDescription||"Test Google Drive API integration for applicant assessment")),y.message&&React.createElement(t.Notice,{status:y.type,isDismissible:!0,onRemove:""},y.message),m?React.createElement("div",{className:"sui-box"},React.createElement("div",{className:"sui-box-header"},React.createElement("h2",{className:"sui-box-title"},v.credentialsTitle||"Set Google Drive Credentials")),React.createElement("div",{className:"sui-box-body"},React.createElement("div",{className:"sui-box-settings-row"},React.createElement(t.TextControl,{help:(0,e.createInterpolateElement)(v.clientIdHelp||"You can get Client ID from <a>Google Cloud Console</a>. Make sure to enable Google Drive API.",{a:React.createElement("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer"})}),label:v.clientIdLabel||"Client ID",value:D.clientId,onChange:e=>T(n(n({},D),{},{clientId:e}))})),React.createElement("div",{className:"sui-box-settings-row"},React.createElement(t.TextControl,{help:(0,e.createInterpolateElement)(v.clientSecretHelp||"You can get Client Secret from <a>Google Cloud Console</a>.",{a:React.createElement("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank",rel:"noopener noreferrer"})}),label:v.clientSecretLabel||"Client Secret",value:D.clientSecret,onChange:e=>T(n(n({},D),{},{clientSecret:e})),type:"password"})),React.createElement("div",{className:"sui-box-settings-row"},React.createElement("span",null,v.redirectUriLabel||"Please use this URL"," ",React.createElement("em",null,window.wpmudevDriveTest.redirectUri)," ",v.redirectUriLabel?"":"in your Google API's Authorized redirect URIs field.")),React.createElement("div",{className:"sui-box-settings-row"},React.createElement("p",null,React.createElement("strong",null,v.requiredScopesTitle||"Required scopes for Google Drive API:")),React.createElement("ul",null,React.createElement("li",null,"https://www.googleapis.com/auth/drive.file"),React.createElement("li",null,"https://www.googleapis.com/auth/drive.readonly")))),React.createElement("div",{className:"sui-box-footer"},React.createElement("div",{className:"sui-actions-right"},React.createElement(t.Button,{variant:"primary",onClick:async()=>{if(console.log("WPMU DEV Plugin Test: Save credentials clicked"),D.clientId.trim()&&D.clientSecret.trim()){console.log("WPMU DEV Plugin Test: Starting credentials save"),w(!0);try{const e={client_id:D.clientId,client_secret:D.clientSecret};console.log("WPMU DEV Plugin Test: Sending request:",e);const t=await fetch("/wp-json/wpmudev/v1/drive/save-credentials",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wpmudevDriveTest.nonce},body:JSON.stringify(e)});console.log("WPMU DEV Plugin Test: Response status:",t.status);const a=await t.json();console.log("WPMU DEV Plugin Test: Response data:",a),a.success?(P(v.credentialsSaved||"Credentials saved successfully!","success"),d(!0),u(!1)):P(a.message||v.credentialsSaveError||"Failed to save credentials","error")}catch(e){console.error("WPMU DEV Plugin Test: Error saving credentials:",e),P((v.errorSavingCredentials||"Error saving credentials:")+" "+e.message,"error")}finally{w(!1)}}else P(v.enterBothCredentials||"Please enter both Client ID and Client Secret","error")},disabled:p},p?React.createElement(t.Spinner,null):v.saveCredentialsButton||"Save Credentials")))):o?React.createElement(React.Fragment,null,React.createElement("div",{className:"sui-box"},React.createElement("div",{className:"sui-box-header"},React.createElement("h2",{className:"sui-box-title"},v.uploadFileButton||"Upload File to Drive")),React.createElement("div",{className:"sui-box-body"},React.createElement("div",{className:"sui-box-settings-row"},React.createElement("input",{type:"file",onChange:e=>h(e.target.files[0]),className:"drive-file-input"}),f&&React.createElement("p",null,React.createElement("strong",null,v.noFileSelected||"Selected:")," ",f.name," (",Math.round(f.size/1024)," KB)"))),React.createElement("div",{className:"sui-box-footer"},React.createElement("div",{className:"sui-actions-right"},React.createElement(t.Button,{variant:"primary",onClick:async()=>{if(f){w(!0);try{const e=new FormData;e.append("file",f);const t=await fetch("/wp-json/wpmudev/v1/drive/upload",{method:"POST",headers:{"X-WP-Nonce":window.wpmudevDriveTest.nonce},body:e}),a=await t.json();a.success&&a.file?(P(v.fileUploaded||"File uploaded successfully!","success"),h(null),await C()):P(a.message||v.fileUploadError||"Failed to upload file","error")}catch(e){P((v.errorUploadingFile||"Error uploading file:")+" "+e.message,"error")}finally{w(!1)}}else P(v.selectFile||"Please select a file to upload","error")},disabled:p||!f},p?React.createElement(t.Spinner,null):v.uploadFileButton||"Upload to Drive")))),React.createElement("div",{className:"sui-box"},React.createElement("div",{className:"sui-box-header"},React.createElement("h2",{className:"sui-box-title"},v.createFolderButton||"Create New Folder")),React.createElement("div",{className:"sui-box-body"},React.createElement("div",{className:"sui-box-settings-row"},React.createElement(t.TextControl,{label:v.folderNamePlaceholder||"Folder Name",value:R,onChange:b,placeholder:v.folderNamePlaceholder||"Enter folder name"}))),React.createElement("div",{className:"sui-box-footer"},React.createElement("div",{className:"sui-actions-right"},React.createElement(t.Button,{variant:"secondary",onClick:async()=>{if(R.trim()){w(!0);try{const e=await fetch("/wp-json/wpmudev/v1/drive/create-folder",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wpmudevDriveTest.nonce},body:JSON.stringify({name:R})}),t=await e.json();t.success&&t.folder?(P(v.folderCreated||"Folder created successfully!","success"),b(""),await C()):P(t.message||v.folderCreateError||"Failed to create folder","error")}catch(e){P((v.errorCreatingFolder||"Error creating folder:")+" "+e.message,"error")}finally{w(!1)}}else P(v.enterFolderName||"Please enter a folder name","error")},disabled:p||!R.trim()},p?React.createElement(t.Spinner,null):v.createFolderButton||"Create Folder")))),React.createElement("div",{className:"sui-box"},React.createElement("div",{className:"sui-box-header"},React.createElement("h2",{className:"sui-box-title"},v.filesTitle||"Your Drive Files"),React.createElement("div",{className:"sui-actions-right"},React.createElement(t.Button,{variant:"secondary",onClick:C,disabled:p},p?React.createElement(t.Spinner,null):v.refreshFilesButton||"Refresh Files"))),React.createElement("div",{className:"sui-box-body"},p?React.createElement("div",{className:"drive-loading"},React.createElement(t.Spinner,null),React.createElement("p",null,v.loading||"Loading files...")):E.length>0?React.createElement("div",{className:"drive-files-grid"},E.map(e=>React.createElement("div",{key:e.id,className:"drive-file-item"},React.createElement("div",{className:"file-info"},React.createElement("strong",null,e.name),React.createElement("small",null,e.isFolder?v.fileTypeFolder||"Folder":"".concat(v.fileTypeFile||"File"," (").concat(e.size?Math.round(e.size/1024)+" KB":"Unknown size",")")),React.createElement("small",null,e.modifiedTime?new Date(e.modifiedTime).toLocaleDateString():"Unknown date")),React.createElement("div",{className:"file-actions"},!e.isFolder&&React.createElement(t.Button,{variant:"secondary",size:"small",onClick:()=>(async(e,t)=>{w(!0);try{const a=await fetch("/wp-json/wpmudev/v1/drive/download?file_id=".concat(e),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wpmudevDriveTest.nonce}}),l=await a.json();if(l.success&&l.content){const e=new Blob([Uint8Array.from(atob(l.content),e=>e.charCodeAt(0))],{type:l.mimeType}),a=window.URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n),P("File downloaded successfully!","success")}else P(l.message||"Failed to download file","error")}catch(e){P("Error downloading file: "+e.message,"error")}finally{w(!1)}})(e.id,e.name),disabled:p},v.downloadButton||"Download"),e.webViewLink&&React.createElement(t.Button,{variant:"link",size:"small",href:e.webViewLink,target:"_blank"},v.viewInDriveButton||"View in Drive"))))):React.createElement("div",{className:"sui-box-settings-row"},React.createElement("p",null,v.noFilesFound||"No files found in your Drive. Upload a file or create a folder to get started."))))):React.createElement("div",{className:"sui-box"},React.createElement("div",{className:"sui-box-header"},React.createElement("h2",{className:"sui-box-title"},v.authTitle||"Authenticate with Google Drive")),React.createElement("div",{className:"sui-box-body"},React.createElement("div",{className:"sui-box-settings-row"},React.createElement("p",null,v.authDescription||"Please authenticate with Google Drive to proceed with the test."),React.createElement("p",null,React.createElement("strong",null,v.authPermissionsTitle||"This test will require the following permissions:")),React.createElement("ul",null,React.createElement("li",null,v.authPermission1||"View and manage Google Drive files"),React.createElement("li",null,v.authPermission2||"Upload new files to Drive"),React.createElement("li",null,v.authPermission3||"Create folders in Drive")))),React.createElement("div",{className:"sui-box-footer"},React.createElement("div",{className:"sui-actions-left"},React.createElement(t.Button,{variant:"secondary",onClick:()=>u(!0)},v.changeCredentialsButton||"Change Credentials")),React.createElement("div",{className:"sui-actions-right"},React.createElement(t.Button,{variant:"primary",onClick:async()=>{w(!0);try{const e=await fetch("/wp-json/wpmudev/v1/drive/auth",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wpmudevDriveTest.nonce}}),t=await e.json();t.success&&t.auth_url?window.location.href=t.auth_url:P(t.message||v.authError||"Failed to start authentication","error")}catch(e){P((v.errorAuthenticating||"Error starting authentication:")+" "+e.message,"error")}finally{w(!1)}},disabled:p},p?React.createElement(t.Spinner,null):v.authenticateButton||"Authenticate with Google Drive")))))};i&&window.wpmudevDriveTest?e.createRoot?(0,e.createRoot)(i).render(React.createElement(e.StrictMode,null,React.createElement(o,null))):(0,e.render)(React.createElement(e.StrictMode,null,React.createElement(o,null)),i):console.error("WPMU DEV Drive Test: Cannot render component - missing DOM element or localized data")})();
//# sourceMappingURL=drivetestpage.min.js.map